{% extends "base.html" %}
{% block title %}Import Flights{% endblock %}

{% block content %}
<div class="form-card">
    <h1>Import Flights from CSV ðŸ“¤</h1>
    <p>Upload a CSV file with columns: <code>origin</code>, <code>destination</code>, and <code>date</code>.</p>
    
    <form method="post" enctype="multipart/form-data" class="add-form" id="import-form">
        <input type="file" name="file" id="file-input" accept=".csv" required hidden>
        <md-outlined-button type="button" id="select-file-btn">
            Choose File
        </md-outlined-button>
        <span id="file-name-display">No file chosen</span>
    
        <div class="form-actions">
            <md-filled-button type="submit" id="submit-btn">Upload and Import</md-filled-button>
            <md-circular-progress indeterminate id="import-loader" style="display: none;"></md-circular-progress>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
    const fileInput = document.getElementById('file-input');
    const selectFileBtn = document.getElementById('select-file-btn');
    const fileNameDisplay = document.getElementById('file-name-display');
    
    // New elements for submission state
    const importForm = document.getElementById('import-form');
    const submitBtn = document.getElementById('submit-btn');
    const loader = document.getElementById('import-loader');

    // When the visible button is clicked, trigger the hidden file input
    selectFileBtn.addEventListener('click', () => {
        fileInput.click();
    });

    // When a file is chosen, update the text display
    fileInput.addEventListener('change', () => {
        if (fileInput.files.length > 0) {
            fileNameDisplay.textContent = fileInput.files[0].name;
        } else {
            fileNameDisplay.textContent = 'No file chosen';
        }
    });

    // When the form is submitted, show the loading state
    importForm.addEventListener('submit', () => {
        // Disable the button to prevent double-clicks
        submitBtn.disabled = true;
        // Show the spinner
        loader.style.display = 'flex';
        // Optional: Change the button text
        submitBtn.textContent = 'Importing...';
    });
</script>
{% endblock %}